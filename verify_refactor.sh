#!/bin/bash

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘           ğŸ” éªŒè¯é‡æ„åçš„ä»£ç                                   â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

success_count=0
fail_count=0
total_count=0

for img in examples/*.jpg; do
    total_count=$((total_count + 1))
    filename=$(basename "$img")
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo "æµ‹è¯• $total_count: $filename"
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    
    # è¿è¡ŒOCRè¯†åˆ«
    result=$(uv run python main.py --ocr-image "$img" 2>&1)
    exit_code=$?
    
    if [ $exit_code -eq 0 ]; then
        # æå–è¯†åˆ«ç»“æœ
        recognized=$(echo "$result" | grep "è¯†åˆ«æˆåŠŸ:" | sed 's/.*è¯†åˆ«æˆåŠŸ: "\(.*\)"/\1/')
        detected=$(echo "$result" | grep "æ£€æµ‹åˆ°" | grep "ä¸ªæ–‡æœ¬åŒºåŸŸ" | head -1)
        filtered=$(echo "$result" | grep "è·³è¿‡: Xè½´åç¦»ä¸­å¿ƒ" | wc -l | tr -d ' ')
        adopted=$(echo "$result" | grep "âœ“ é‡‡ç”¨:" | wc -l | tr -d ' ')
        
        echo "âœ… æµ‹è¯•é€šè¿‡"
        echo "   $detected"
        if [ -n "$recognized" ]; then
            echo "   è¯†åˆ«ç»“æœ: \"$recognized\""
        else
            echo "   è¯†åˆ«ç»“æœ: [ç©º]"
        fi
        echo "   Xè½´è¿‡æ»¤: $filtered ä¸ª"
        echo "   é‡‡ç”¨æ–‡æœ¬: $adopted ä¸ª"
        success_count=$((success_count + 1))
    else
        echo "âŒ æµ‹è¯•å¤±è´¥ (é€€å‡ºç : $exit_code)"
        fail_count=$((fail_count + 1))
    fi
    echo ""
done

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ğŸ“Š æµ‹è¯•æ€»ç»“"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "æ€»è®¡æµ‹è¯•: $total_count ä¸ª"
echo "âœ… æˆåŠŸ: $success_count ä¸ª"
echo "âŒ å¤±è´¥: $fail_count ä¸ª"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

if [ $fail_count -eq 0 ]; then
    echo "ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é‡æ„éªŒè¯æˆåŠŸï¼"
else
    echo "âš ï¸  æœ‰ $fail_count ä¸ªæµ‹è¯•å¤±è´¥"
    exit 1
fi

